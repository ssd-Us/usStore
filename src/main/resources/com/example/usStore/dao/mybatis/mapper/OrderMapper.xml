<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.example.usStore.dao.mybatis.mapper.OrderMapper">

	<cache />

	<select id="getOrder" resultType="Orders">
		select
			BILLADDR1,
			BILLADDR2,
			BILLCITY,
			BILLCOUNTRY,
			BILLTOUSERNAME,
			BILLZIP,
			SHIPADDR1,
			SHIPADDR2,
			SHIPCITY,
			SHIPCOUNTRY,
			SHIPTOUSERNAME,
			SHIPZIP,
			CARDTYPE,
			COURIER,
			CREDITCARD,
			EXPRDATE AS expiryDate,
			LOCALE,
			ORDERDATE,
			ORDERS.ORDERID,
			TOTALPRICE,
			USERID,
			STATUS
		FROM ORDERS
		WHERE ORDERS.ORDERID = #{value}
	</select>

	<select id="getOrdersByUserId" resultType="Orders">
		SELECT
			BILLADDR1,
			BILLADDR2,
			BILLCITY,
			BILLCOUNTRY,
			BILLTOUSERNAME,
			BILLZIP,
			SHIPADDR1,
			SHIPADDR2,
			SHIPCITY,
			SHIPCOUNTRY,
			SHIPTOUSERNAME,
			SHIPZIP,
			CARDTYPE,
			COURIER,
			CREDITCARD,
			EXPRDATE AS expiryDate,
			LOCALE,
			ORDERDATE,
			ORDERS.ORDERID,
			TOTALPRICE,
			USERID,
			STATUS
		FROM ORDERS
		WHERE ORDERS.USERID = #{value}
		ORDER BY ORDERDATE
	</select>

	<resultMap id="OrderAndLineitemMap" type="Orders">
		<id column="ORDERID" property="orderId" />
		<result column="USERNAME" property="username" />
		<result column="ORDERDATE" property="orderDate" />
		<collection property="lineItems" ofType="LineItem">
			<id column="ORDERID" property="orderId" />
			<id column="LINENUM" property="lineNumber" />
			<result column="ITEMID" property="itemId" />
			<result column="QUANTITY" property="quantity" />
			<result column="UNITPRICE" property="unitPrice" />
		</collection>
	</resultMap>

	<select id="getOrderAndLineitems" resultMap="OrderAndLineitemMap">
		SELECT
			BILLADDR1, BILLADDR2, BILLCITY, BILLCOUNTRY,
			BILLTOUSERNAME, BILLZIP, SHIPADDR1, SHIPADDR2,
			SHIPCITY, SHIPCOUNTRY, SHIPTOUSERNAME, SHIPZIP, CARDTYPE, COURIER,
			CREDITCARD, EXPRDATE AS expiryDate, LOCALE, ORDERDATE, ORDERS.ORDERID,
			TOTALPRICE, USERID, STATUS,
			LINEITEM.LINENUM, LINEITEM.ITEMID, LINEITEM.QUANTITY, LINEITEM.UNITPRICE
		FROM ORDERS, ORDERSTATUS, LINEITEM
		WHERE ORDERS.ORDERID = #{value}
				AND ORDERS.ORDERID = LINEITEM.ORDERID
	</select>

	<insert id="insertOrder">
		INSERT INTO ORDERS (ORDERID, USERID, ORDERDATE, SHIPADDR1, SHIPADDR2,
				SHIPCITY,
				SHIPZIP, SHIPCOUNTRY, BILLADDR1, BILLADDR2, BILLCITY, BILLZIP, BILLCOUNTRY,
				COURIER, TOTALPRICE, BILLTOUSERNAME, SHIPTOUSERNAME,
				CREDITCARD, EXPRDATE, CARDTYPE, LOCALE)
		VALUES(#{orderId}, #{userId}, #{orderDate},
				#{shipAddr1}, #{shipAddr2,jdbcType=VARCHAR}, #{shipCity},
				#{shipZip}, #{shipCountry}, #{billAddr1}, #{billAddr2,jdbcType=VARCHAR},
				#{billCity}, #{billZip}, #{billCountry}, #{courier}, #{totalPrice}, #{billToUsername},
				#{shipToUsername}, #{creditCard}, #{expiryDate}, #{cardType}, #{locale})
	</insert>

	<insert id="msSqlServerInsertOrder" useGeneratedKeys="true">
		insert into orders (userId, orderDate, shipaddr1, shipaddr2,
				shipCity, shipState, shipZip, shipCountry, billaddr1, billaddr2,
				billCity, billZip, billCountry, courier, totalPrice,
				billtoUsername, shiptoUsername, creditCard, exprDate, cardType, locale)
		values (#userId#,
				#orderDate#, #shipAddress1#, #shipAddress2:VARCHAR#, #shipCity#,
				#shipState#, #shipZip#, #shipCountry#, #billAddress1#,
				#billAddress2:VARCHAR#, #billCity#, #billState#, #billZip#,
				#billCountry#, #courier#, #totalPrice#, #billToFirstName#,
				#billToLastName#, #shipToFirstName#, #shipToLastName#,
				#creditCard#, #expiryDate#, #cardType#, #locale#);
		select @@identity as value
	</insert>

</mapper>